<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🍼 婴幼儿健康追踪系统</title>
    <link rel="stylesheet" href="style.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <!-- 主容器 -->
    <div class="container">
        <!-- 头部 -->
        <div class="header">
            <h1>🍼 婴幼儿健康追踪系统</h1>
            <p>💕 基于WHO 2006标准的智能生长发育监测工具 (桌面版)</p>
        </div>

        <!-- 标签页导航 -->
        <div class="tabs">
            <div class="tab-button active" data-tab="basic-info">
                👶 宝宝基本信息
            </div>
            <div class="tab-button" data-tab="upload">
                📤 上传体检报告  
            </div>
            <div class="tab-button" data-tab="manual">
                ✏️ 添加体检记录
            </div>
            <div class="tab-button" data-tab="records">
                📈 历史体检记录
            </div>
            <div class="tab-button" data-tab="chart">
                📊 生长曲线图
            </div>
            <div class="tab-button" data-tab="feeding">
                🍼 个性化喂养指导
            </div>
            <div class="tab-button" data-tab="settings">
                🔧 系统设置
            </div>
        </div>

        <!-- 👶 宝宝基本信息 -->
        <div id="basic-info" class="tab-content active">
            <div class="card">
                <h3>👶 宝宝基本信息</h3>
                
                <div class="info-box warning">
                    <h4>🌟 重要提示</h4>
                    <p>请先完整填写宝宝的基本信息（姓名、性别、出生日期），然后才能上传体检报告或添加体检记录。系统将根据出生日期自动计算精确的月龄。</p>
                </div>

                <div class="form-group">
                    <label for="babyName">👶 宝宝姓名:</label>
                    <input type="text" id="babyName" placeholder="请输入宝宝姓名">
                </div>

                <div class="form-group">
                    <label for="babyGender">⚧️ 性别:</label>
                    <select id="babyGender">
                        <option value="">请选择性别</option>
                        <option value="male">👦 男</option>
                        <option value="female">👧 女</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="babyBirthDate">🎂 出生日期:</label>
                    <input type="date" id="babyBirthDate" min="2020-01-01" max="2030-12-31">
                    <small style="display: block; color: #666; margin-top: 5px;">📅 格式：YYYY-MM-DD (例如：2022-02-22)</small>
                </div>

                <!-- 当前状态显示 -->
                <div class="card" style="margin-top: 20px;">
                    <h3>📊 当前状态</h3>
                    <div class="percentiles">
                        <div class="percentile-item">
                            <span class="percentile-value" id="currentAge">--</span>
                            <span class="percentile-label">当前年龄(月)</span>
                        </div>
                        <div class="percentile-item">
                            <span class="percentile-value" id="currentHeight">--</span>
                            <span class="percentile-label">当前身高(cm)</span>
                        </div>
                        <div class="percentile-item">
                            <span class="percentile-value" id="currentWeight">--</span>
                            <span class="percentile-label">当前体重(kg)</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 📤 上传体检报告 -->
        <div id="upload" class="tab-content">
            <div class="card">
                <h3>📤 上传体检报告</h3>
                <p>上传体检报告图片，系统将使用OCR自动识别并提取相关数据</p>
                
                <div class="upload-area" onclick="document.getElementById('reportUpload').click()">
                    <div class="upload-icon">📷</div>
                    <div class="upload-text">点击或拖拽图片到此处</div>
                    <div class="upload-hint">支持 JPG、PNG、WEBP 格式，大小不超过10MB</div>
                </div>
                <input type="file" id="reportUpload" accept="image/*" style="display: none;">
                
                <!-- 上传状态 -->
                <div id="loadingMessage" class="loading hidden">
                    <div class="loading-spinner"></div>
                    <span>正在分析中，请稍候...</span>
                </div>
                
                <!-- 图片预览 -->
                <div id="uploadedImage" class="card hidden" style="margin-top: 20px;">
                    <h4>📷 上传的图片</h4>
                    <img id="previewImage" style="max-width: 100%; border-radius: 10px;" alt="预览图片">
                </div>
            </div>
        </div>

        <!-- ✏️ 添加体检记录 -->
        <div id="manual" class="tab-content">
            <div class="card">
                <h3>✏️ 添加体检记录</h3>
                
                <div class="form-row">
                    <div class="form-col">
                        <label for="checkDate">📅 体检日期:</label>
                        <input type="date" id="checkDate" min="2020-01-01" max="2030-12-31">
                        <small style="display: block; color: #666; margin-top: 5px;">📅 选择体检日期后会自动计算月龄</small>
                    </div>
                    <div class="form-col">
                        <label for="ageMonths">👶 年龄(月):</label>
                        <input type="number" id="ageMonths" step="0.1" min="0" max="60" placeholder="例如: 6.5">
                        <small style="display: block; color: #666; margin-top: 5px;">📊 月龄将根据出生日期自动计算</small>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-col">
                        <label for="height">📏 身高(cm):</label>
                        <input type="number" id="height" step="0.1" min="30" max="150" placeholder="例如: 65.5">
                    </div>
                    <div class="form-col">
                        <label for="weight">⚖️ 体重(kg):</label>
                        <input type="number" id="weight" step="0.1" min="1" max="50" placeholder="例如: 7.2">
                    </div>
                </div>

                <div class="form-group">
                    <label for="headCircumference">🧠 头围(cm):</label>
                    <input type="number" id="headCircumference" step="0.1" min="25" max="65" placeholder="例如: 42.5">
                </div>

                <!-- 百分位显示 -->
                <div class="percentiles">
                    <div class="percentile-item">
                        <span class="percentile-value" id="heightPercentile">--</span>
                        <span class="percentile-label">身高百分位</span>
                    </div>
                    <div class="percentile-item">
                        <span class="percentile-value" id="weightPercentile">--</span>
                        <span class="percentile-label">体重百分位</span>
                    </div>
                    <div class="percentile-item">
                        <span class="percentile-value" id="headPercentile">--</span>
                        <span class="percentile-label">头围百分位</span>
                    </div>
                </div>

                <div style="text-align: center; margin-top: 20px;">
                    <button id="addRecordBtn" class="btn btn-primary">✨ 添加记录</button>
                    <button id="clearFormBtn" class="btn btn-secondary">🗑️ 清空表单</button>
                </div>
            </div>
        </div>

        <!-- 📈 历史体检记录 -->
        <div id="records" class="tab-content">
            <div class="card">
                <div class="records-header">
                    <h3>📈 历史体检记录</h3>
                    <button id="clearAllRecordsBtn" class="btn btn-danger">🗑️ 一键清除</button>
                </div>
                
                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>📅 体检日期</th>
                                <th>👶 年龄</th>
                                <th>📏 身高(cm)</th>
                                <th>📊 身高百分位</th>
                                <th>⚖️ 体重(kg)</th>
                                <th>📊 体重百分位</th>
                                <th>🧠 头围(cm)</th>
                                <th>📊 头围百分位</th>
                                <th>🛠️ 操作</th>
                            </tr>
                        </thead>
                        <tbody id="recordsTableBody">
                        </tbody>
                    </table>
                </div>
                
                <div id="noRecords" class="message" style="text-align: center; padding: 40px;">
                    <h4>🤔 暂无体检记录，请先添加记录</h4>
                </div>
                
                <!-- 统计信息 -->
                <div id="statisticsInfo">
                    <h4>📊 统计信息</h4>
                    <p>暂无数据</p>
                </div>
            </div>
        </div>

        <!-- 📊 生长曲线图 -->
        <div id="chart" class="tab-content">
            <div class="card">
                <h3>📊 生长曲线图</h3>
                
                <!-- 图表类型选择 -->
                <div class="chart-type-selector">
                    <label><input type="radio" name="chartType" value="height" checked> 📏 身高曲线</label>
                    <label><input type="radio" name="chartType" value="weight"> ⚖️ 体重曲线</label>
                    <label><input type="radio" name="chartType" value="headCircumference"> 🧠 头围曲线</label>
                </div>
                
                <!-- 图表容器 -->
                <div class="chart-container">
                    <canvas id="growthChart"></canvas>
                </div>
                
                <!-- 图表说明 -->
                <div class="chart-legend">
                    <h4>📊 图表说明</h4>
                    <div class="chart-legend-items">
                        <div class="chart-legend-item">
                            <div class="chart-legend-color" style="background-color: #ff6b6b;"></div>
                            <span>■ -2SD (3%) ■ +2SD (97%)</span>
                        </div>
                        <div class="chart-legend-item">
                            <div class="chart-legend-color" style="background-color: #ffa726;"></div>
                            <span>■ -1SD (15%) ■ +1SD (85%)</span>
                        </div>
                        <div class="chart-legend-item">
                            <div class="chart-legend-color" style="background-color: #4caf50;"></div>
                            <span>■ 50%百分位 (平均值)</span>
                        </div>
                        <div class="chart-legend-item">
                            <div class="chart-legend-color" style="background-color: #2196f3;"></div>
                            <span>🍼 宝宝实际数据</span>
                        </div>
                    </div>
                </div>
                
                <!-- 生长趋势分析 -->
                <div class="chart-analysis">
                    <h4>📈 生长趋势分析</h4>
                    <ul>
                        <li>🌈 正常范围：-2SD 到 +2SD 之间（3% - 97%）</li>
                        <li>⭐ 理想范围：-1SD 到 +1SD 之间（15% - 85%）</li>
                        <li>⚠️ 如果数据点连续偏离正常范围，建议咨询儿科医生</li>
                    </ul>
                </div>
            </div>
        </div>

        <!-- 🍼 个性化喂养指导 -->
        <div id="feeding" class="tab-content">
            <div class="card">
                <h3>🍼 个性化喂养指导</h3>
                <p>基于您孩子的年龄、身高和体重，获取个性化的喂养建议</p>
                
                <!-- 当前状态 -->
                <div class="percentiles" style="margin-bottom: 20px;">
                    <div class="percentile-item">
                        <span class="percentile-value" id="feedingAge">--</span>
                        <span class="percentile-label">当前年龄</span>
                    </div>
                    <div class="percentile-item">
                        <span class="percentile-value" id="feedingHeight">--</span>
                        <span class="percentile-label">当前身高</span>
                    </div>
                    <div class="percentile-item">
                        <span class="percentile-value" id="feedingWeight">--</span>
                        <span class="percentile-label">当前体重</span>
                    </div>
                </div>
                
                <div style="text-align: center; margin: 20px 0;">
                    <button id="generateFeedingBtn" class="btn btn-primary">🤖 生成AI喂养建议</button>
                </div>
                
                <!-- 加载状态 -->
                <div id="feedingLoading" class="loading hidden">
                    <div class="loading-spinner"></div>
                    <span>正在生成喂养建议，请稍候...</span>
                </div>
                
                <!-- 喂养指导内容 -->
                <div id="feedingGuide" class="hidden">
                    <div class="card">
                        <h4>📋 每日营养需求</h4>
                        <div id="nutritionContent">
                            <p>点击上方"生成AI喂养建议"按钮获取个性化营养建议</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>🥗 食物推荐</h4>
                        <div id="foodContent">
                            <p>点击上方"生成AI喂养建议"按钮获取个性化食物推荐</p>
                        </div>
                    </div>
                    
                    <div class="card">
                        <h4>💡 喂养技巧</h4>
                        <div id="tipsContent">
                            <p>点击上方"生成AI喂养建议"按钮获取个性化喂养技巧</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 🔧 系统设置 -->
        <div id="settings" class="tab-content">
            <div class="card">
                <h3>🔧 系统设置</h3>
                
                <!-- API配置 -->
                <div class="card">
                    <h4>🔑 AI增强配置</h4>
                    <p>用于智能解析识别结果和生成喂养建议</p>
                    
                    <div class="api-input-group">
                        <input type="password" id="apiKeyInput" placeholder="请输入Deepseek API密钥">
                        <button id="saveApiKeyBtn" class="btn btn-secondary">💾 保存</button>
                    </div>
                    
                    <div class="api-status">
                        <div class="status-indicator" id="apiStatus"></div>
                        <span id="apiStatusText">😴 未连接</span>
                    </div>
                    
                    <div class="info-box info">
                        <h5>💡 使用说明</h5>
                        <ul>
                            <li>需要有效的Deepseek API密钥才能使用AI增强功能</li>
                            <li>API密钥将安全保存在本地浏览器中</li>
                            <li>可以访问 <strong>Deepseek官网</strong> 获取API密钥</li>
                            <li>即使没有AI密钥，基础功能仍然可用</li>
                        </ul>
                    </div>
                </div>
                
                <!-- 数据管理 -->
                <div class="card">
                    <h4>💾 数据管理</h4>
                    <p>您可以导出或导入所有数据</p>
                    
                    <div style="text-align: center; margin: 20px 0;">
                        <button id="exportBtn" class="btn btn-success">📤 导出数据</button>
                        <button id="importBtn" class="btn btn-success">📥 导入数据</button>
                    </div>
                    
                    <div class="info-box warning">
                        <h5>⚠️ 数据安全说明</h5>
                        <ul>
                            <li>所有数据仅保存在您的电脑本地存储中</li>
                            <li>数据不会上传到任何服务器</li>
                            <li>建议定期导出备份重要数据</li>
                            <li>卸载应用可能会丢失所有记录</li>
                        </ul>
                    </div>
                </div>
                
                <!-- 系统信息 -->
                <div class="card">
                    <h4>📋 系统信息</h4>
                    <p><strong>🎀 版本：</strong>1.0.0 桌面版</p>
                    <p><strong>📅 更新日期：</strong>2025-06-11</p>
                    <p><strong>📊 数据标准：</strong>WHO 2006儿童生长标准</p>
                    
                    <div class="info-box success">
                        <h5>✨ 功能特点</h5>
                        <ul>
                            <li>📊 自动计算WHO百分位数 - 精确到0.1月龄的线性插值</li>
                            <li>✏️ 手动添加体检记录 - 支持所有生长指标</li>
                            <li>📈 生长曲线可视化展示 - 5条WHO标准线+个人曲线</li>
                            <li>🤖 AI个性化喂养建议 - 智能分析健康状况</li>
                            <li>💾 数据本地安全存储 - 完全离线使用</li>
                            <li>📋 数据导入导出功能 - 方便数据管理和备份</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript -->
    <script src="baby-tracker.js"></script>
</body>
</html>
